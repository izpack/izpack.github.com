<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [izpack-changes] r1961 - in izpack-src/trunk: . src/dist-files	src/lib/com/izforge/izpack src/lib/com/izforge/izpack/compiler	src/lib/com/izforge/izpack/installer	src/lib/com/izforge/izpack/panels	src/lib/com/izforge/izpack/util src/lib/net/n3/nanoxml	src/tests src/tests/net src/tests/net/n3	src/tests/net/n3/nanoxml src/tests/net/n3/nanoxml/xinclude
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:izpack-changes%40lists.berlios.de?Subject=%5Bizpack-changes%5D%20r1961%20-%20in%20izpack-src/trunk%3A%20.%20src/dist-files%0A%09src/lib/com/izforge/izpack%20src/lib/com/izforge/izpack/compiler%0A%09src/lib/com/izforge/izpack/installer%0A%09src/lib/com/izforge/izpack/panels%0A%09src/lib/com/izforge/izpack/util%20src/lib/net/n3/nanoxml%0A%09src/tests%20src/tests/net%20src/tests/net/n3%0A%09src/tests/net/n3/nanoxml%20src/tests/net/n3/nanoxml/xinclude&In-Reply-To=">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000706.html">
   <LINK REL="Next"  HREF="000708.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[izpack-changes] r1961 - in izpack-src/trunk: . src/dist-files	src/lib/com/izforge/izpack src/lib/com/izforge/izpack/compiler	src/lib/com/izforge/izpack/installer	src/lib/com/izforge/izpack/panels	src/lib/com/izforge/izpack/util src/lib/net/n3/nanoxml	src/tests src/tests/net src/tests/net/n3	src/tests/net/n3/nanoxml src/tests/net/n3/nanoxml/xinclude</H1>
    <B>noreply at berlios.de</B> 
    <A HREF="mailto:izpack-changes%40lists.berlios.de?Subject=%5Bizpack-changes%5D%20r1961%20-%20in%20izpack-src/trunk%3A%20.%20src/dist-files%0A%09src/lib/com/izforge/izpack%20src/lib/com/izforge/izpack/compiler%0A%09src/lib/com/izforge/izpack/installer%0A%09src/lib/com/izforge/izpack/panels%0A%09src/lib/com/izforge/izpack/util%20src/lib/net/n3/nanoxml%0A%09src/tests%20src/tests/net%20src/tests/net/n3%0A%09src/tests/net/n3/nanoxml%20src/tests/net/n3/nanoxml/xinclude&In-Reply-To="
       TITLE="[izpack-changes] r1961 - in izpack-src/trunk: . src/dist-files	src/lib/com/izforge/izpack src/lib/com/izforge/izpack/compiler	src/lib/com/izforge/izpack/installer	src/lib/com/izforge/izpack/panels	src/lib/com/izforge/izpack/util src/lib/net/n3/nanoxml	src/tests src/tests/net src/tests/net/n3	src/tests/net/n3/nanoxml src/tests/net/n3/nanoxml/xinclude">noreply at berlios.de
       </A><BR>
    <I>Mon Dec 17 13:20:19 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000706.html">[izpack-changes] r1960 - izpack-src/trunk
</A></li>
        <LI>Next message: <A HREF="000708.html">[izpack-changes] r1962 - in izpack-src/trunk/src: . dist-files	lib/com/izforge/izpack/compiler lib/com/izforge/izpack/installer	lib/com/izforge/izpack/panels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#707">[ date ]</a>
              <a href="thread.html#707">[ thread ]</a>
              <a href="subject.html#707">[ subject ]</a>
              <a href="author.html#707">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jponge
Date: 2007-12-17 13:20:05 +0100 (Mon, 17 Dec 2007)
New Revision: 1961

Added:
   izpack-src/trunk/src/lib/net/n3/nanoxml/XIncludeXMLBuilder.java
   izpack-src/trunk/src/lib/net/n3/nanoxml/XMLBuilderFactory.java
   izpack-src/trunk/src/tests/net/
   izpack-src/trunk/src/tests/net/n3/
   izpack-src/trunk/src/tests/net/n3/nanoxml/
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/XIncludeXMLBuilderTestCase.java
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/content-fragment.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/content.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/empty-fallback-expect.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/empty-fallback-input.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/fallback-expect.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/fallback-input.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-in-element-expect.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-in-element-input.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-only-expect.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-only-input.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-in-element-expect.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-in-element-input.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-only-expect.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-only-input.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-text-expect.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-text-input.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-text-expect.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-text-input.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-xml-expect.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-xml-input.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/invalid-parse-attrib-input.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/multiple-include-expect.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/multiple-include-input.xml
   izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/text.txt
Modified:
   izpack-src/trunk/Versions.txt
   izpack-src/trunk/src/dist-files/IzPack-install.xml
   izpack-src/trunk/src/lib/com/izforge/izpack/LocaleDatabase.java
   izpack-src/trunk/src/lib/com/izforge/izpack/compiler/CompilerConfig.java
   izpack-src/trunk/src/lib/com/izforge/izpack/installer/AutomatedInstaller.java
   izpack-src/trunk/src/lib/com/izforge/izpack/installer/CompileWorker.java
   izpack-src/trunk/src/lib/com/izforge/izpack/installer/InstallerFrame.java
   izpack-src/trunk/src/lib/com/izforge/izpack/installer/ProcessPanelWorker.java
   izpack-src/trunk/src/lib/com/izforge/izpack/panels/ShortcutPanel.java
   izpack-src/trunk/src/lib/com/izforge/izpack/panels/UserInputPanel.java
   izpack-src/trunk/src/lib/com/izforge/izpack/util/SpecHelper.java
   izpack-src/trunk/src/lib/net/n3/nanoxml/StdXMLBuilder.java
   izpack-src/trunk/src/lib/net/n3/nanoxml/StdXMLReader.java
   izpack-src/trunk/src/lib/net/n3/nanoxml/XMLParserFactory.java
Log:
Support of XInclude-like constructs (Matthew Fudge, Volantis Systems Ltd. via Julien Ponge)



Modified: izpack-src/trunk/Versions.txt
===================================================================
--- izpack-src/trunk/Versions.txt	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/Versions.txt	2007-12-17 12:20:05 UTC (rev 1961)
@@ -71,7 +71,8 @@
 - Installer files: support of a 'requiresjdk' element to specify wether a JDK is required for the
   software to install (instead of just a JRE). This is a light test performed like 'javaversion'
   before the installer frame appears. (Julien Ponge)
-
+- Support of XInclude-like constructs (Matthew Fudge, Volantis Systems Ltd.
+  via Julien Ponge)
   
   &gt; 3.10.2 (build 2007.05.11)
 

Modified: izpack-src/trunk/src/dist-files/IzPack-install.xml
===================================================================
--- izpack-src/trunk/src/dist-files/IzPack-install.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/dist-files/IzPack-install.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -37,6 +37,7 @@
             &lt;author email=&quot;&quot; name=&quot;Sergio Banos Calvo (contributor)&quot; /&gt;
             &lt;author email=&quot;&quot; name=&quot;Loic Bardon (contributor)&quot; /&gt;
             &lt;author email=&quot;&quot; name=&quot;Kerekes Balazs (contributor)&quot; /&gt;
+	    &lt;author email=&quot;&quot; name=&quot;Matthew Fudge (Volantis Systems Ltd., contributors)&quot; /&gt;
             &lt;author email=&quot;&quot; name=&quot;Andreas Guenther (contributor)&quot; /&gt;
             &lt;author email=&quot;&quot; name=&quot;Michael Hagedorn (contributor)&quot; /&gt;
             &lt;author email=&quot;&quot; name=&quot;Dick Hollenbeck (contributor)&quot; /&gt;

Modified: izpack-src/trunk/src/lib/com/izforge/izpack/LocaleDatabase.java
===================================================================
--- izpack-src/trunk/src/lib/com/izforge/izpack/LocaleDatabase.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/com/izforge/izpack/LocaleDatabase.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -25,10 +25,10 @@
 import java.util.Vector;
 
 import net.n3.nanoxml.NonValidator;
-import net.n3.nanoxml.StdXMLBuilder;
 import net.n3.nanoxml.StdXMLParser;
 import net.n3.nanoxml.StdXMLReader;
 import net.n3.nanoxml.XMLElement;
+import net.n3.nanoxml.XMLBuilderFactory;
 
 /**
  * Represents a database of a locale.
@@ -64,7 +64,7 @@
     {
         // Initialises the parser
         StdXMLParser parser = new StdXMLParser();
-        parser.setBuilder(new StdXMLBuilder());
+        parser.setBuilder(XMLBuilderFactory.createXMLBuilder());
         parser.setReader(new StdXMLReader(in));
         parser.setValidator(new NonValidator());
 

Modified: izpack-src/trunk/src/lib/com/izforge/izpack/compiler/CompilerConfig.java
===================================================================
--- izpack-src/trunk/src/lib/com/izforge/izpack/compiler/CompilerConfig.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/com/izforge/izpack/compiler/CompilerConfig.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -75,11 +75,11 @@
 
 import net.n3.nanoxml.IXMLReader;
 import net.n3.nanoxml.NonValidator;
-import net.n3.nanoxml.StdXMLBuilder;
 import net.n3.nanoxml.StdXMLParser;
 import net.n3.nanoxml.StdXMLReader;
 import net.n3.nanoxml.XMLElement;
 import net.n3.nanoxml.XMLException;
+import net.n3.nanoxml.XMLBuilderFactory;
 
 /**
  * A parser for the installer xml configuration. This parses a document
@@ -1001,7 +1001,7 @@
             }
             
             StdXMLParser refXMLParser = new StdXMLParser();
-            refXMLParser.setBuilder(new StdXMLBuilder());
+            refXMLParser.setBuilder(XMLBuilderFactory.createXMLBuilder());
             refXMLParser.setReader(refXMLReader);
             refXMLParser.setValidator(new NonValidator());
 
@@ -1692,7 +1692,7 @@
         }
 
         StdXMLParser parser = new StdXMLParser();
-        parser.setBuilder(new StdXMLBuilder());
+        parser.setBuilder(XMLBuilderFactory.createXMLBuilder());
         parser.setReader(reader);
         parser.setValidator(new NonValidator());
 

Modified: izpack-src/trunk/src/lib/com/izforge/izpack/installer/AutomatedInstaller.java
===================================================================
--- izpack-src/trunk/src/lib/com/izforge/izpack/installer/AutomatedInstaller.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/com/izforge/izpack/installer/AutomatedInstaller.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -40,10 +40,10 @@
 import java.util.zip.ZipOutputStream;
 
 import net.n3.nanoxml.NonValidator;
-import net.n3.nanoxml.StdXMLBuilder;
 import net.n3.nanoxml.StdXMLParser;
 import net.n3.nanoxml.StdXMLReader;
 import net.n3.nanoxml.XMLElement;
+import net.n3.nanoxml.XMLBuilderFactory;
 
 import com.izforge.izpack.CustomData;
 import com.izforge.izpack.ExecutableFile;
@@ -454,7 +454,7 @@
 
         // Initialises the parser
         StdXMLParser parser = new StdXMLParser();
-        parser.setBuilder(new StdXMLBuilder());
+        parser.setBuilder(XMLBuilderFactory.createXMLBuilder());
         parser.setReader(new StdXMLReader(in));
         parser.setValidator(new NonValidator());
 

Modified: izpack-src/trunk/src/lib/com/izforge/izpack/installer/CompileWorker.java
===================================================================
--- izpack-src/trunk/src/lib/com/izforge/izpack/installer/CompileWorker.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/com/izforge/izpack/installer/CompileWorker.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -40,10 +40,10 @@
 import java.util.Vector;
 
 import net.n3.nanoxml.NonValidator;
-import net.n3.nanoxml.StdXMLBuilder;
 import net.n3.nanoxml.StdXMLParser;
 import net.n3.nanoxml.StdXMLReader;
 import net.n3.nanoxml.XMLElement;
+import net.n3.nanoxml.XMLBuilderFactory;
 
 import com.izforge.izpack.LocaleDatabase;
 import com.izforge.izpack.util.Debug;
@@ -240,7 +240,7 @@
         }
 
         StdXMLParser parser = new StdXMLParser();
-        parser.setBuilder(new StdXMLBuilder());
+        parser.setBuilder(XMLBuilderFactory.createXMLBuilder());
         parser.setValidator(new NonValidator());
 
         try

Modified: izpack-src/trunk/src/lib/com/izforge/izpack/installer/InstallerFrame.java
===================================================================
--- izpack-src/trunk/src/lib/com/izforge/izpack/installer/InstallerFrame.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/com/izforge/izpack/installer/InstallerFrame.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -84,11 +84,11 @@
 import javax.swing.text.JTextComponent;
 
 import net.n3.nanoxml.NonValidator;
-import net.n3.nanoxml.StdXMLBuilder;
 import net.n3.nanoxml.StdXMLParser;
 import net.n3.nanoxml.StdXMLReader;
 import net.n3.nanoxml.XMLElement;
 import net.n3.nanoxml.XMLWriter;
+import net.n3.nanoxml.XMLBuilderFactory;
 
 import com.izforge.izpack.CustomData;
 import com.izforge.izpack.ExecutableFile;
@@ -351,7 +351,7 @@
             }
 
             StdXMLParser parser = new StdXMLParser();
-            parser.setBuilder(new StdXMLBuilder());
+            parser.setBuilder(XMLBuilderFactory.createXMLBuilder());
             parser.setValidator(new NonValidator());
             parser.setReader(new StdXMLReader(input));
 
@@ -443,7 +443,7 @@
 
         // Initialises the parser
         StdXMLParser parser = new StdXMLParser();
-        parser.setBuilder(new StdXMLBuilder());
+        parser.setBuilder(XMLBuilderFactory.createXMLBuilder());
         parser.setReader(new StdXMLReader(inXML));
         parser.setValidator(new NonValidator());
 
@@ -495,7 +495,7 @@
 
       // Initialises the parser
       StdXMLParser parser = new StdXMLParser();
-      parser.setBuilder(new StdXMLBuilder());
+      parser.setBuilder(XMLBuilderFactory.createXMLBuilder());
       parser.setReader(new StdXMLReader(inXML));
       parser.setValidator(new NonValidator());
 

Modified: izpack-src/trunk/src/lib/com/izforge/izpack/installer/ProcessPanelWorker.java
===================================================================
--- izpack-src/trunk/src/lib/com/izforge/izpack/installer/ProcessPanelWorker.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/com/izforge/izpack/installer/ProcessPanelWorker.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -38,10 +38,10 @@
 import java.util.Vector;
 
 import net.n3.nanoxml.NonValidator;
-import net.n3.nanoxml.StdXMLBuilder;
 import net.n3.nanoxml.StdXMLParser;
 import net.n3.nanoxml.StdXMLReader;
 import net.n3.nanoxml.XMLElement;
+import net.n3.nanoxml.XMLBuilderFactory;
 
 import com.izforge.izpack.Pack;
 import com.izforge.izpack.rules.Condition;
@@ -117,7 +117,7 @@
         }
 
         StdXMLParser parser = new StdXMLParser();
-        parser.setBuilder(new StdXMLBuilder());
+        parser.setBuilder(XMLBuilderFactory.createXMLBuilder());
         parser.setValidator(new NonValidator());
 
         XMLElement spec;

Modified: izpack-src/trunk/src/lib/com/izforge/izpack/panels/ShortcutPanel.java
===================================================================
--- izpack-src/trunk/src/lib/com/izforge/izpack/panels/ShortcutPanel.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/com/izforge/izpack/panels/ShortcutPanel.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -49,10 +49,10 @@
 import javax.swing.event.ListSelectionListener;
 
 import net.n3.nanoxml.NonValidator;
-import net.n3.nanoxml.StdXMLBuilder;
 import net.n3.nanoxml.StdXMLParser;
 import net.n3.nanoxml.StdXMLReader;
 import net.n3.nanoxml.XMLElement;
+import net.n3.nanoxml.XMLBuilderFactory;
 
 import com.izforge.izpack.ExecutableFile;
 import com.izforge.izpack.Pack;
@@ -830,7 +830,7 @@
          * System.out.println( &quot;==================================================================&quot; ); }
          */
         StdXMLParser parser = new StdXMLParser();
-        parser.setBuilder(new StdXMLBuilder());
+        parser.setBuilder(XMLBuilderFactory.createXMLBuilder());
         parser.setValidator(new NonValidator());
         parser.setReader(StdXMLReader.stringReader(substitutedSpec));
 

Modified: izpack-src/trunk/src/lib/com/izforge/izpack/panels/UserInputPanel.java
===================================================================
--- izpack-src/trunk/src/lib/com/izforge/izpack/panels/UserInputPanel.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/com/izforge/izpack/panels/UserInputPanel.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -54,10 +54,10 @@
 import javax.swing.text.Document;
 
 import net.n3.nanoxml.NonValidator;
-import net.n3.nanoxml.StdXMLBuilder;
 import net.n3.nanoxml.StdXMLParser;
 import net.n3.nanoxml.StdXMLReader;
 import net.n3.nanoxml.XMLElement;
+import net.n3.nanoxml.XMLBuilderFactory;
 
 import com.izforge.izpack.LocaleDatabase;
 import com.izforge.izpack.Pack;
@@ -1145,7 +1145,7 @@
 
         // initialize the parser
         StdXMLParser parser = new StdXMLParser();
-        parser.setBuilder(new StdXMLBuilder());
+        parser.setBuilder(XMLBuilderFactory.createXMLBuilder());
         parser.setValidator(new NonValidator());
         parser.setReader(new StdXMLReader(input));
 

Modified: izpack-src/trunk/src/lib/com/izforge/izpack/util/SpecHelper.java
===================================================================
--- izpack-src/trunk/src/lib/com/izforge/izpack/util/SpecHelper.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/com/izforge/izpack/util/SpecHelper.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -29,10 +29,10 @@
 import java.util.Vector;
 
 import net.n3.nanoxml.NonValidator;
-import net.n3.nanoxml.StdXMLBuilder;
 import net.n3.nanoxml.StdXMLParser;
 import net.n3.nanoxml.StdXMLReader;
 import net.n3.nanoxml.XMLElement;
+import net.n3.nanoxml.XMLBuilderFactory;
 
 import com.izforge.izpack.installer.InstallerException;
 import com.izforge.izpack.installer.ResourceManager;
@@ -142,7 +142,7 @@
 
         // initialize the parser
         StdXMLParser parser = new StdXMLParser();
-        parser.setBuilder(new StdXMLBuilder());
+        parser.setBuilder(XMLBuilderFactory.createXMLBuilder());
         parser.setValidator(new NonValidator());
         parser.setReader(new StdXMLReader(input));
 

Modified: izpack-src/trunk/src/lib/net/n3/nanoxml/StdXMLBuilder.java
===================================================================
--- izpack-src/trunk/src/lib/net/n3/nanoxml/StdXMLBuilder.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/net/n3/nanoxml/StdXMLBuilder.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -63,6 +63,36 @@
     }
 
     /**
+     * Return the element that is currently being processed
+     *
+     * @return  the element that is currently being processed
+     */
+    protected XMLElement getCurrentElement() {
+        return (XMLElement) stack.peek();
+    }
+
+    /**
+     * Return the stack used for processing the elements.
+     *
+     * @return  the stack used for processing the elements.
+     */
+    protected Stack getStack() {
+        return stack;
+    }
+
+    /**
+     * Set the root element to a new element. This causes the internal stack
+     * to be flushed and the supplied element to be pushed onto it
+     *
+     * @param element the new root element.
+     */
+    protected void setRootElement(XMLElement element) {
+        stack.clear();
+        stack.push(element);
+        this.root = element;
+    }
+
+    /**
      * Cleans up the object when it's destroyed.
      */
     protected void finalize() throws Throwable

Modified: izpack-src/trunk/src/lib/net/n3/nanoxml/StdXMLReader.java
===================================================================
--- izpack-src/trunk/src/lib/net/n3/nanoxml/StdXMLReader.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/net/n3/nanoxml/StdXMLReader.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -138,7 +138,7 @@
         }
         catch (MalformedURLException e)
         {
-            systemID = &quot;file:&quot; + systemID;
+            systemID = &quot;<A HREF="file://&quot;">file://&quot;</A> + systemID;
 
             try
             {

Added: izpack-src/trunk/src/lib/net/n3/nanoxml/XIncludeXMLBuilder.java
===================================================================
--- izpack-src/trunk/src/lib/net/n3/nanoxml/XIncludeXMLBuilder.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/net/n3/nanoxml/XIncludeXMLBuilder.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,368 @@
+/*
+ * Copyright 2007 Volantis Systems Ltd., All Rights Reserved.
+ *
+ * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     <A HREF="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</A>
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package net.n3.nanoxml;
+
+import java.io.IOException;
+import java.io.InputStream;
+import java.io.InputStreamReader;
+import java.net.HttpURLConnection;
+import java.net.MalformedURLException;
+import java.net.URL;
+import java.net.URLConnection;
+import java.util.Iterator;
+import java.util.Stack;
+import java.util.Vector;
+
+/**
+ * Extend the XMLBuilder to add XInclude functionality
+ */
+public class XIncludeXMLBuilder extends StdXMLBuilder {
+    /**
+     * Namespace to for XInclude  (NOTE that this is not used
+     * at the moment). The specification can be found
+     * here'&gt;<A HREF="http://www.w3.org/TR/xinclude/&quot;">http://www.w3.org/TR/xinclude/&quot;</A>&gt;here.
+     */
+    public static final String INCLUDE_NS = &quot;<A HREF="http://www.w3.org/2001/XInclude&quot;;">http://www.w3.org/2001/XInclude&quot;;</A>
+    /**
+     * The name of the include element (this should be &quot;include&quot; using the
+     * {@link #INCLUDE_NS} but namespaces are not supported
+     */
+    public static final String INCLUDE_ELEMENT = &quot;xinclude&quot;;
+    /**
+     * The location of the included data
+     */
+    public static final String HREF_ATTRIB = &quot;href&quot;;
+
+    /**
+     * The xpointer attribute. This must not be used when &quot;parse='text'&quot;
+     */
+    public static final String XPOINTER_ATTRIB = &quot;xpointer&quot;;
+
+    /**
+     * The attribute to decribe the encoding of the text include (no effect when
+     * parse='xml')
+     */
+    public static final String ENCODING_ATTRIB = &quot;encoding&quot;;
+
+    /**
+     * The attribute describing the accept header that will be used with
+     * http based includes.
+     */
+    public static final String ACCEPT_ENCODING = &quot;accept&quot;;
+
+    /**
+     * The element for handling fallbacks. This should be called &quot;fallback&quot; and
+     * be in the {@link #INCLUDE_NS} but namespaces are not supported
+     */
+    public static final String FALLBACK_ELEMENT = &quot;xfallback&quot;;
+
+    /**
+     * Parse attribute. If missing this implies &quot;xml&quot; its other valid value
+     * is &quot;text&quot;
+     */
+    public static final String PARSE_ATTRIB = &quot;parse&quot;;
+
+    /**
+     * Namespace for the &quot;fragment&quot; element used to include xml documents with
+     * no explicit root node.
+     */
+    public static final String FRAGMENT_NS = &quot;<A HREF="https://izpack.github.io/izpack/fragment&quot;;">https://izpack.github.io/izpack/fragment&quot;;</A>
+
+    /**
+     * The name of the fragment element is a root node element that can be
+     * used to wrap xml fragments for inclusion. It is removed during the
+     * include operation. This should be called &quot;fragment&quot; and be in the
+     * {@link #FRAGMENT_NS} but namespaces are not supported.
+     */
+    public static final String FRAGMENT = &quot;xfragment&quot;;
+
+    // Javadoc inherited
+    public void endElement(String name, String nsPrefix, String nsSystemID) {
+        // get the current element before it gets popped from the stack
+        XMLElement element = getCurrentElement();
+        // let normal processing occur
+        super.endElement(name, nsPrefix, nsSystemID);
+        // now process the &quot;include&quot; element
+        processXInclude(element);
+    }
+
+    /**
+     * This method handles XInclude elements in the code
+     *
+     * @param element the node currently being procesed. In this case it should
+     *            be the {@link #INCLUDE_ELEMENT}
+     */
+    private void processXInclude(final XMLElement element) {
+        if (INCLUDE_ELEMENT.equals(element.getName())) {
+
+            Vector fallbackChildren = element.getChildrenNamed(FALLBACK_ELEMENT);
+            if (element.getChildrenCount() != fallbackChildren.size() ||
+                fallbackChildren.size() &gt; 1) {
+                throw new RuntimeException(new XMLParseException(
+                    element.getSystemID(),
+                    element.getLineNr(),
+                    INCLUDE_ELEMENT + &quot; can optionally have a single &quot; +
+                        FRAGMENT + &quot; as a child&quot;));
+            }
+            boolean usingFallback = false;
+
+            String href = element.getAttribute(HREF_ATTRIB, &quot;&quot;);
+            if (!href.equals(&quot;&quot;)) { // including an external file.
+
+                IXMLReader reader = null;
+                try {
+                    reader = getReader(element);
+                } catch (Exception e) { // yes really catch all exceptions
+                    // ok failed to read from the location for some reason.
+                    // see if we have a fallback
+                    reader = handleFallback(element);
+                    usingFallback = true;
+                }
+                String parse = element.getAttribute(PARSE_ATTRIB, &quot;xml&quot;);
+                // process as text if we are not using our fallback and the parse
+                // type is &quot;text&quot;
+                if (&quot;text&quot;.equals(parse) &amp;&amp; !usingFallback) {
+                    includeText(element, reader);
+                } else if (&quot;xml&quot;.equals(parse)) {
+                    includeXML(element, reader);
+                } else {
+                    throw new RuntimeException(
+                        new XMLParseException(
+                            element.getSystemID(),
+                            element.getLineNr(),
+                            PARSE_ATTRIB + &quot; attribute of &quot; + INCLUDE_ELEMENT +
+                                &quot; must be \&quot;xml\&quot; or \&quot;text\&quot; but was &quot; +
+                                parse));
+                }
+            } else { // including part of this file rather then an external one
+                if (!element.hasAttribute(XPOINTER_ATTRIB)) {
+                    throw new RuntimeException(
+                        new XMLParseException(
+                            element.getSystemID(),
+                            element.getLineNr(),
+                            XPOINTER_ATTRIB + &quot;must be specified if href is &quot; +
+                                &quot;empty or missing&quot;));
+                }
+            }
+        }
+    }
+
+    /**
+     * Handle the fallback if one exists. If one does not exist then throw
+     * a runtime exception as this is a fatal error
+     *
+     * @param include the include element
+     * @return a reader for the fallback
+     */
+    private IXMLReader handleFallback(XMLElement include) {
+        Vector fallbackChildren = include.getChildrenNamed(FALLBACK_ELEMENT);
+        if (fallbackChildren.size() == 1) {
+            // process fallback
+
+            XMLElement fallback = (XMLElement) fallbackChildren.get(0);
+            // fallback element can only contain a CDATA so it will not have
+            // its content in un-named children
+            String content = fallback.getContent();
+            if (content != null) {
+                content = content.trim();
+            }
+
+            if (&quot;&quot;.equals(content) || content == null) {
+                // an empty fragment requires us to just remove the &quot;include&quot;
+                // element. A nasty hack follows:
+                // a &quot;fragment&quot; with no children will just be removed along with
+                // the &quot;include&quot; element.
+                content = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;iso-8859-1\&quot; standalone=\&quot;yes\&quot; ?&gt;&lt;&quot;+ FRAGMENT + &quot;/&gt;&quot;;
+            } 
+            return StdXMLReader.stringReader(content);
+        } else {
+            throw new RuntimeException(new XMLParseException(
+                include.getSystemID(),
+                include.getLineNr(),
+                &quot;could not load content&quot;));
+        }
+    }
+
+    /**
+     * Include the xml contained in the specified reader. This content will be
+     * parsed and attached to the parent of the &lt;param&gt;element&lt;/param&gt; node
+     *
+     * @param element the include element
+     * @param reader  the reader containing the xml to parse and include.
+     */
+    private void includeXML(final XMLElement element, IXMLReader reader) {
+
+        try {
+            Stack stack = getStack();
+            // set up a new parser to parse the include file.
+            StdXMLParser parser = new StdXMLParser();
+            parser.setBuilder(XMLBuilderFactory.createXMLBuilder());
+            parser.setReader(reader);
+            parser.setValidator(new NonValidator());
+
+            XMLElement childroot = (XMLElement) parser.parse();
+            // if the include element was the root element in the original
+            // document then keep the element as-is (i.e.
+            // don't remove the &quot;fragment&quot; element from the included content
+            if (stack.isEmpty()) {
+                setRootElement(childroot);
+            } else {
+                XMLElement parent = (XMLElement) stack.peek();
+                // remove the include element from its parent
+                parent.removeChild(element);
+
+                // if there was a &quot;fragment&quot; included remove the fragment
+                // element and attach its children in place of this include
+                // element.
+                if (FRAGMENT.equals(childroot.getName())) {
+                    Vector grandchildren = childroot.getChildren();
+                    Iterator it = grandchildren.iterator();
+                    while (it.hasNext()) {
+                        XMLElement grandchild = (XMLElement) it.next();
+                        parent.addChild(grandchild);
+                    }
+                } else {
+                    // if it was a complete document included then
+                    // just add it in place of the include element
+                    parent.addChild(childroot);
+                }
+            }
+        } catch (XMLException e) {
+            throw new RuntimeException(new XMLParseException(
+                element.getSystemID(), element.getLineNr(), e.getMessage()));
+        }
+    }
+
+
+    /**
+     * Include plain text. The reader contains the content in the appropriate
+     * encoding as determined by the {@link #ENCODING_ATTRIB} if one was
+     * present.
+     *
+     * @param element the include element
+     * @param reader  the reader containing the include text
+     */
+    private void includeText(XMLElement element, IXMLReader reader) {
+
+        if (element.getAttribute(&quot;xpointer&quot;) != null) {
+            throw new RuntimeException(new XMLParseException(
+                &quot;xpointer cannot be used with parse='text'&quot;));
+        }
+
+        Stack stack = getStack();
+        if (stack.isEmpty()) {
+            throw new RuntimeException(new XMLParseException(
+                element.getSystemID(),
+                element.getLineNr(),
+                &quot;cannot include text as the root node&quot;));
+        }
+
+        // remove the include element from the parent
+        XMLElement parent = (XMLElement)stack.peek();
+        parent.removeChild(element);
+        StringBuffer buffer = new StringBuffer();
+        try {
+            while (!reader.atEOF()) {
+                buffer.append(reader.read());
+            }
+        } catch (IOException e) {
+            throw new RuntimeException(new XMLParseException(
+                element.getSystemID(), element.getLineNr(), e.getMessage()));
+        }
+
+        if (parent.getChildrenCount() == 0) {
+            // no children so just set the content as there cannot have been
+            // any content there already
+            parent.setContent(buffer.toString());
+        } else {
+            // nanoxml also claims to store #PCDATA in unnamed children
+            // if there was a combination of #PCDATA and child elements.
+            // This should put it in the correct place as we haven't finihshed
+            // parsing the children of includes parent yet.
+            XMLElement content = new XMLElement();
+            content.setContent(buffer.toString());
+            parent.addChild(content);
+        }
+    }
+
+    /**
+     * Return a reader for the specified {@link #INCLUDE_ELEMENT}. The caller
+     * is responsible for closing the reader produced.
+     *
+     * @param element the include element to obtain a reader for
+     * @return a reader for the include element
+     * @throws XMLParseException if a problem occurs parsing the
+     *                           {@link #INCLUDE_ELEMENT}
+     * @throws IOException       if the href cannot be read
+     */
+    private IXMLReader getReader(XMLElement element) throws XMLParseException, IOException {
+        String href = element.getAttribute(HREF_ATTRIB);
+        // This is a bit nasty but is a simple way of handling files that are
+        // not fully qualified urls
+        URL url = null;
+        try {
+            // standard URL
+            url = new URL(href);
+        } catch (MalformedURLException e) {
+            try {
+                // absolute file without a protocol
+                if (href.charAt(0) == '/') {
+                    url = new URL(&quot;<A HREF="file://&quot;">file://&quot;</A> + href);
+                } else {
+                    // relative file
+                    url = new URL(new URL(element.getSystemID()), href);
+                }
+            } catch (MalformedURLException e1) {
+                    new XMLParseException(element.getSystemID(),
+                    element.getLineNr(), &quot;malformed url '&quot; + href + &quot;'&quot;);
+            }
+        }
+
+        URLConnection connection = url.openConnection();
+        // special handling for http and https
+        if (connection instanceof HttpURLConnection &amp;&amp;
+            element.hasAttribute(ENCODING_ATTRIB)) {
+            connection.setRequestProperty(
+                &quot;accept&quot;, element.getAttribute(ENCODING_ATTRIB));
+        }
+
+        InputStream is = connection.getInputStream();
+
+        InputStreamReader reader = null;
+        // Only pay attention to the {@link #ENCODING_ATTRIB} if parse='text'  
+        if (element.getAttribute(PARSE_ATTRIB, &quot;xml&quot;).equals(&quot;text&quot;) &amp;&amp;
+            element.hasAttribute(ENCODING_ATTRIB)) {
+            reader = new InputStreamReader(
+                is, element.getAttribute(ENCODING_ATTRIB, &quot;&quot;));
+        } else {
+            reader = new InputStreamReader(is);
+        }
+
+        IXMLReader ireader = new StdXMLReader(reader);
+        ireader.setSystemID(url.toExternalForm());
+        return ireader;
+    }
+
+    /**
+     * used to record the system id for this document.
+     *
+     * @param systemID the system id of the document being built
+     * @param lineNr the line number 
+     */
+    public void startBuilding(String systemID, int lineNr) {
+        super.startBuilding(systemID, lineNr);
+    }
+}

Added: izpack-src/trunk/src/lib/net/n3/nanoxml/XMLBuilderFactory.java
===================================================================
--- izpack-src/trunk/src/lib/net/n3/nanoxml/XMLBuilderFactory.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/net/n3/nanoxml/XMLBuilderFactory.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,31 @@
+/*
+ * Copyright 2007 Volantis Systems Ltd., All Rights Reserved.
+ *
+ * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     <A HREF="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</A>
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package net.n3.nanoxml;
+
+/**
+ * Simple factory for creating builders
+ */
+public class XMLBuilderFactory {
+
+    /**
+     * Return an IXMLBuilder instance
+     *
+     * @return an IXMLBuilder instance
+     */
+    public static IXMLBuilder createXMLBuilder() {
+        return new XIncludeXMLBuilder();
+    }
+}

Modified: izpack-src/trunk/src/lib/net/n3/nanoxml/XMLParserFactory.java
===================================================================
--- izpack-src/trunk/src/lib/net/n3/nanoxml/XMLParserFactory.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/lib/net/n3/nanoxml/XMLParserFactory.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -65,7 +65,7 @@
     {
         String className = System.getProperty(XMLParserFactory.CLASS_KEY,
                 XMLParserFactory.DEFAULT_CLASS);
-        return XMLParserFactory.createXMLParser(className, new StdXMLBuilder());
+        return XMLParserFactory.createXMLParser(className, XMLBuilderFactory.createXMLBuilder());
     }
 
     /**

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/XIncludeXMLBuilderTestCase.java
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/XIncludeXMLBuilderTestCase.java	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/XIncludeXMLBuilderTestCase.java	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,217 @@
+/*
+ * Copyright 2007 Volantis Systems Ltd., All Rights Reserved.
+ *
+ * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     <A HREF="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</A>
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package net.n3.nanoxml.xinclude;
+
+import junit.framework.TestCase;
+import net.n3.nanoxml.IXMLReader;
+import net.n3.nanoxml.NonValidator;
+import net.n3.nanoxml.StdXMLParser;
+import net.n3.nanoxml.StdXMLReader;
+import net.n3.nanoxml.XMLBuilderFactory;
+import net.n3.nanoxml.XMLElement;
+
+import java.util.Enumeration;
+
+/**
+ * Test the XInclude style functionality added to the XMLBuilder
+ */
+public class XIncludeXMLBuilderTestCase extends TestCase {
+
+
+    /**
+     * This method takes the fileBase name and attempts to find two files
+     * called &amp;lt;fileBase&amp;gt;-input.xml and &amp;lt;fileBase&amp;gt;-expected.xml
+     *
+     * @param fileBase the base of the test file names
+     * @throws Exception
+     */
+    public void doTest(String fileBase) throws Exception {
+
+        String baseURL = getClass().getResource(fileBase + &quot;-input.xml&quot;).toExternalForm();
+        // set up a new parser to parse the input xml (with includes)
+        StdXMLParser inputParser = new StdXMLParser();
+        inputParser.setBuilder(XMLBuilderFactory.createXMLBuilder());
+        IXMLReader inputReader = new StdXMLReader(
+            getClass().getResourceAsStream(fileBase + &quot;-input.xml&quot;));
+        inputReader.setSystemID(baseURL);
+        inputParser.setReader(inputReader);
+        inputParser.setValidator(new NonValidator());
+
+        // set up a new parser to parse the expected xml (without includes)
+        StdXMLParser expectedParser = new StdXMLParser();
+        expectedParser.setBuilder(XMLBuilderFactory.createXMLBuilder());
+        IXMLReader expectedReader = new StdXMLReader(
+            getClass().getResourceAsStream(fileBase + &quot;-expect.xml&quot;));
+        expectedReader.setSystemID(baseURL);
+        expectedParser.setReader(expectedReader);
+        expectedParser.setValidator(new NonValidator());
+
+        XMLElement inputElement = (XMLElement) inputParser.parse();
+        XMLElement expectedElement = (XMLElement) expectedParser.parse();
+
+        deepEqual(expectedElement, inputElement);
+        
+    }
+
+    /**
+     * This method is used to ensure that the contents of the specified file
+     * (when having &quot;-input.xml&quot; appended) cause the parser to fail
+     *
+     * @param fileBase the base name of the input file.
+     * @throws Exception
+     */
+    public void ensureFailure(String fileBase) throws Exception {
+        try {
+            String baseURL = getClass().getResource(fileBase + &quot;-input.xml&quot;).toExternalForm();
+            // set up a new parser to parse the input xml (with includes)
+            StdXMLParser inputParser = new StdXMLParser();
+            inputParser.setBuilder(XMLBuilderFactory.createXMLBuilder());
+            IXMLReader inputReader = new StdXMLReader(
+                getClass().getResourceAsStream(fileBase + &quot;-input.xml&quot;));
+            inputReader.setSystemID(baseURL);
+            inputParser.setReader(inputReader);
+            inputParser.setValidator(new NonValidator());
+
+            inputParser.parse();
+            fail(&quot;an exception should have been thrown&quot;);
+        } catch (Throwable t) {
+            // success
+        }
+    }
+
+    /**
+     * Perform a deep equality check on the two nodes.
+     *
+     */
+    public void deepEqual(XMLElement a, XMLElement b) {
+
+        assertEquals(&quot;element names&quot;, a.getName(), b.getName());
+        assertEquals(&quot;element attributes for &quot;+ a.getName(),
+            a.getAttributes(), b.getAttributes());
+        assertEquals(&quot;content for &quot; + a.getName(),
+            a.getContent(), b.getContent());
+        assertEquals(&quot;equal number of children&quot; + a.getName(),
+            a.getChildrenCount(), b.getChildrenCount());
+
+        Enumeration aChildren = a.enumerateChildren();
+        Enumeration bChildren = b.enumerateChildren();
+        while (aChildren.hasMoreElements()) {
+            XMLElement aChild = (XMLElement) aChildren.nextElement();
+            XMLElement bChild = (XMLElement) bChildren.nextElement();
+            deepEqual(aChild,  bChild);
+        }
+    }
+
+    /**
+     * Test Empty document with include
+     * @throws Exception
+     */
+    public void testIncludeOnly() throws Exception {
+       doTest(&quot;include-only&quot;);
+    }
+
+    /**
+     * Test that a fragment included as the root node does not have the
+     * &quot;fragment&quot; element removed
+     * @throws Exception
+     */
+    public void testIncludeFragmentOnly() throws Exception {
+        doTest(&quot;include-fragment-only&quot;);
+    }
+
+    /**
+     * Test to ensure that content is correctly included when the include
+     * element is not the root element
+     * @throws Exception
+     */
+    public void testIncludeInElement() throws Exception {
+        doTest(&quot;include-in-element&quot;);
+    }
+
+    /**
+     * Test to ensure that content is correctly included when the include
+     * element is not the root element
+     * @throws Exception
+     */
+    public void testIncludeFragmentInElement() throws Exception {
+        doTest(&quot;include-fragment-in-element&quot;);
+    }
+
+    /**
+     * Test text inclusion
+     * @throws Exception
+     */
+    public void testIncludeTextInElement() throws Exception {
+        doTest(&quot;include-fragment-in-element&quot;);
+    }
+
+    /**
+     * Ensure that the parse attribute accepts &quot;text&quot; and treats it like text
+     * @throws Exception
+     */
+    public void testParseAttributeText() throws Exception {
+       doTest(&quot;include-xml-as-text&quot;);
+    }
+
+    /**
+     * Ensure that the parse attribute accepts &quot;xml&quot; and treats like xml
+     * (most other tests do not explicitly set the parse parameter and let it
+     * default to &quot;xml&quot;
+     * @throws Exception
+     */
+    public void testParseAttributeXML() throws Exception {
+       doTest(&quot;include-xml-as-xml&quot;);
+    }
+
+    /**
+     * Make sure that a failure occurs for a parse valid that is not &quot;xml&quot;
+     * or &quot;text&quot;
+     *
+     * @throws Exception
+     */
+    public void testParseInvalidAttribute() throws Exception {
+        ensureFailure(&quot;invalid-parse-attrib&quot;);
+    }
+
+    /**
+     * Ensure fallbacks work correctly
+     *
+     * @throws Exception
+     */
+    public void testFallback() throws Exception {
+        doTest(&quot;fallback&quot;);
+    }
+
+    /**
+     * Test that an empty fallback just removes the include and fallback
+     * elements
+     *
+     * @throws Exception
+     */
+    public void testEmptyFallback() throws Exception {
+        doTest(&quot;empty-fallback&quot;);
+    }
+
+    /**
+     * Ensure that two includes in the same element both get included
+     * @throws Exception
+     */
+    public void testMultipleIncludes() throws Exception {
+        doTest(&quot;multiple-include&quot;);        
+    }
+
+
+}

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/content-fragment.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/content-fragment.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/content-fragment.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,10 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;xfragment&gt;
+    &lt;ffff&gt;
+        &lt;gggg&gt;hello&lt;/gggg&gt;
+    &lt;/ffff&gt;
+
+    &lt;hhhh&gt;
+        &lt;iiii&gt;there&lt;/iiii&gt;
+    &lt;/hhhh&gt;
+&lt;/xfragment&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/content.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/content.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/content.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,10 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;eeee&gt;
+    &lt;ffff&gt;
+        &lt;gggg&gt;hello&lt;/gggg&gt;
+    &lt;/ffff&gt;
+
+    &lt;hhhh&gt;
+        &lt;iiii&gt;there&lt;/iiii&gt;
+    &lt;/hhhh&gt;
+&lt;/eeee&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/empty-fallback-expect.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/empty-fallback-expect.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/empty-fallback-expect.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,3 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;aaa&gt;
+&lt;/aaa&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/empty-fallback-input.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/empty-fallback-input.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/empty-fallback-input.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,6 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;aaa&gt;
+    &lt;xinclude href=&quot;does-not-exist.xml&quot;&gt;
+        &lt;xfallback/&gt;           
+    &lt;/xinclude&gt;
+&lt;/aaa&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/fallback-expect.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/fallback-expect.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/fallback-expect.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,4 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;aaa&gt;
+    [&lt;bbb/&gt;
+&lt;/aaa&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/fallback-input.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/fallback-input.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/fallback-input.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,8 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;aaa&gt;
+    &lt;xinclude href=&quot;does-not-exist.xml&quot;&gt;
+        &lt;xfallback&gt;
+            &lt;![CDATA[&lt;bbb/&gt;]]&gt;
+        &lt;/xfallback&gt;
+    &lt;/xinclude&gt;
+&lt;/aaa&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-in-element-expect.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-in-element-expect.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-in-element-expect.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,10 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;bob&gt;
+    &lt;ffff&gt;
+        &lt;gggg&gt;hello&lt;/gggg&gt;
+    &lt;/ffff&gt;
+
+    &lt;hhhh&gt;
+        &lt;iiii&gt;there&lt;/iiii&gt;
+    &lt;/hhhh&gt;
+&lt;/bob&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-in-element-input.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-in-element-input.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-in-element-input.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,4 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;bob&gt;
+    &lt;xinclude href=&quot;content-fragment.xml&quot;/&gt;
+&lt;/bob&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-only-expect.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-only-expect.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-only-expect.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,10 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;xfragment&gt;
+    &lt;ffff&gt;
+        &lt;gggg&gt;hello&lt;/gggg&gt;
+    &lt;/ffff&gt;
+
+    &lt;hhhh&gt;
+        &lt;iiii&gt;there&lt;/iiii&gt;
+    &lt;/hhhh&gt;
+&lt;/xfragment&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-only-input.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-only-input.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-fragment-only-input.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,2 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;xinclude href=&quot;content-fragment.xml&quot;/&gt; 
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-in-element-expect.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-in-element-expect.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-in-element-expect.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,12 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;bob&gt;
+    &lt;eeee&gt;
+        &lt;ffff&gt;
+            &lt;gggg&gt;hello&lt;/gggg&gt;
+        &lt;/ffff&gt;
+
+        &lt;hhhh&gt;
+            &lt;iiii&gt;there&lt;/iiii&gt;
+        &lt;/hhhh&gt;
+    &lt;/eeee&gt;
+&lt;/bob&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-in-element-input.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-in-element-input.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-in-element-input.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,4 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;bob&gt;
+    &lt;xinclude href=&quot;content.xml&quot;/&gt;
+&lt;/bob&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-only-expect.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-only-expect.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-only-expect.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,10 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;eeee&gt;
+    &lt;ffff&gt;
+        &lt;gggg&gt;hello&lt;/gggg&gt;
+    &lt;/ffff&gt;
+
+    &lt;hhhh&gt;
+        &lt;iiii&gt;there&lt;/iiii&gt;
+    &lt;/hhhh&gt;
+&lt;/eeee&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-only-input.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-only-input.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-only-input.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,2 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;xinclude href=&quot;content.xml&quot;/&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-text-expect.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-text-expect.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-text-expect.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,4 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;a&gt;
+This is some sample text that should be included
+&lt;/a&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-text-input.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-text-input.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-text-input.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,4 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;a&gt;
+    &lt;xinclude href=&quot;text.txt&quot; parse=&quot;text&quot;/&gt;
+&lt;/a&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-text-expect.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-text-expect.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-text-expect.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,13 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;aaa&gt;
+&lt;![CDATA[&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;eeee&gt;
+    &lt;ffff&gt;
+        &lt;gggg&gt;hello&lt;/gggg&gt;
+    &lt;/ffff&gt;
+
+    &lt;hhhh&gt;
+        &lt;iiii&gt;there&lt;/iiii&gt;
+    &lt;/hhhh&gt;
+&lt;/eeee&gt;]]&gt;
+&lt;/aaa&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-text-input.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-text-input.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-text-input.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,4 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;aaa&gt;
+    &lt;xinclude href=&quot;content.xml&quot; parse=&quot;text&quot;/&gt;
+&lt;/aaa&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-xml-expect.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-xml-expect.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-xml-expect.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,12 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;aaa&gt;
+    &lt;eeee&gt;
+        &lt;ffff&gt;
+            &lt;gggg&gt;hello&lt;/gggg&gt;
+        &lt;/ffff&gt;
+
+        &lt;hhhh&gt;
+            &lt;iiii&gt;there&lt;/iiii&gt;
+        &lt;/hhhh&gt;
+    &lt;/eeee&gt;
+&lt;/aaa&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-xml-input.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-xml-input.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/include-xml-as-xml-input.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,4 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;aaa&gt;
+    &lt;xinclude href=&quot;content.xml&quot; parse=&quot;xml&quot;/&gt;
+&lt;/aaa&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/invalid-parse-attrib-input.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/invalid-parse-attrib-input.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/invalid-parse-attrib-input.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,4 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;aaa&gt;
+    &lt;xinclude href=&quot;content.xml&quot; parse=&quot;invalid&quot;/&gt;
+&lt;/aaa&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/multiple-include-expect.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/multiple-include-expect.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/multiple-include-expect.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,17 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;aaaa&gt;
+    &lt;ffff&gt;
+        &lt;gggg&gt;hello&lt;/gggg&gt;
+    &lt;/ffff&gt;
+
+    &lt;hhhh&gt;
+        &lt;iiii&gt;there&lt;/iiii&gt;
+    &lt;/hhhh&gt;
+    &lt;ffff&gt;
+        &lt;gggg&gt;hello&lt;/gggg&gt;
+    &lt;/ffff&gt;
+
+    &lt;hhhh&gt;
+        &lt;iiii&gt;there&lt;/iiii&gt;
+    &lt;/hhhh&gt;
+&lt;/aaaa&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/multiple-include-input.xml
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/multiple-include-input.xml	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/multiple-include-input.xml	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1,5 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot; standalone=&quot;yes&quot; ?&gt;
+&lt;aaaa&gt;
+    &lt;xinclude href=&quot;content-fragment.xml&quot;/&gt;
+    &lt;xinclude href=&quot;content-fragment.xml&quot;/&gt;
+&lt;/aaaa&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/text.txt
===================================================================
--- izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/text.txt	2007-12-17 10:33:10 UTC (rev 1960)
+++ izpack-src/trunk/src/tests/net/n3/nanoxml/xinclude/text.txt	2007-12-17 12:20:05 UTC (rev 1961)
@@ -0,0 +1 @@
+This is some sample text that should be included
\ No newline at end of file

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000706.html">[izpack-changes] r1960 - izpack-src/trunk
</A></li>
	<LI>Next message: <A HREF="000708.html">[izpack-changes] r1962 - in izpack-src/trunk/src: . dist-files	lib/com/izforge/izpack/compiler lib/com/izforge/izpack/installer	lib/com/izforge/izpack/panels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#707">[ date ]</a>
              <a href="thread.html#707">[ thread ]</a>
              <a href="subject.html#707">[ subject ]</a>
              <a href="author.html#707">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/izpack-changes">More information about the izpack-changes
mailing list</a><br>
</body></html>
